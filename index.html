<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>SSAFY Code Stacker</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet"><style>
/* ... ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ ... */
body {
font-family: 'Jua', sans-serif;
overflow: hidden;
background: linear-gradient(135deg, #00b3ff, #7e77ff);
}
canvas {
background-color: rgba(255, 255, 255, 0.5);
border-radius: 1rem;
box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
}
.perfect-popup {
animation: popup 0.6s ease-out forwards;
}
@keyframes popup {
0% { transform: translateY(0) scale(0.8); opacity: 1; }
100% { transform: translateY(-60px) scale(1.2); opacity: 0; }
}
.game-container {
touch-action: manipulation;
}
#leaderboard div::-webkit-scrollbar { width: 8px; }
#leaderboard div::-webkit-scrollbar-track { background: rgba(255,255,255,0.3); border-radius: 10px; }
#leaderboard div::-webkit-scrollbar-thumb { background: #8781f3; border-radius: 10px; }
#leaderboard div::-webkit-scrollbar-thumb:hover { background: #906ae9; }
#nicknameInputGameOver.border-red-500::placeholder { color: #5244ef; }
</style>
</head>
<body class="text-gray-800 antialiased">

<div id="app-container" class="w-screen h-screen flex flex-col lg:flex-row items-center justify-center p-4 gap-6">
<div class="game-container flex flex-col items-center justify-center gap-4 w-full max-w-sm lg:max-w-md">
<div class="w-full flex justify-between items-center px-2">
<div class="text-left">
<h1 class="text-3xl font-extrabold text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">SSAFY stacker</h1>
<p class="text-white text-opacity-90 text-sm">ìŠ¤íƒ€í‹°, ì•Œì§€, í•, ì™€ì´ì¦ˆë¥¼ ë†’ì´ ìŒ“ì•„ë³´ì (à¸‡ â€¢Ì€_â€¢Ì)à¸‡ </p>
</div>
<div class="text-right bg-white/70 p-3 rounded-lg shadow-inner">
<div class="text-2xl font-bold text-blue-600">
<span id="score">0</span> <span class="text-lg">ì¸µ</span>
</div>
<div id="combo-display" class="text-sm text-blue-600 font-bold h-5"></div>
</div>
</div>

<div class="relative w-full aspect-[4/5]">
<canvas id="gameCanvas" class="w-full h-full"></canvas>
<div id="popup-container" class="absolute inset-0 flex items-center justify-center pointer-events-none"></div>
<div id="gameOverScreen" class="hidden absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex-col items-center justify-center text-center rounded-2xl p-4">
<h2 class="text-4xl font-extrabold text-red-500 mb-2" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">GAME OVER</h2>
<p class="text-xl text-white mb-4">ìµœì¢… ê¸°ë¡: <span id="finalScore" class="font-bold text-amber-300">0</span> ì¸µ</p>
<div id="gameOverNicknamePrompt" class="hidden my-4 w-full max-w-xs">
<p class="text-white text-sm mb-2">ë­í‚¹ì— í‘œì‹œí•  ë‹‰ë„¤ì„ì„ ì •í•´ì£¼ì„¸ìš”!</p>
<div class="flex gap-2">
<input type="text" id="nicknameInputGameOver" class="w-full p-2 border-2 border-transparent rounded-lg text-center text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="ë‹‰ë„¤ì„ (10ì ì´ë‚´)" maxlength="10">
<button id="saveNicknameBtnGameOver" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-600 transition">ì €ì¥</button>
</div>
</div>

<p id="restartText" class="text-lg text-white animate-pulse">í™”ë©´ì„ í„°ì¹˜í•´ì„œ ë‹¤ì‹œ ì‹œì‘!</p>
</div>
</div>
<div class="text-center text-white/90 w-full flex items-center justify-center gap-2">
<p>ë‹‰ë„¤ì„: <span id="userNicknameDisplay" class="font-bold bg-black/20 px-3 py-1 rounded-full">...</span></p>
<button id="editNicknameBtn" class="bg-white/70 p-2 rounded-full text-xs leading-none hover:bg-white transition">âœï¸</button>
</div>
</div>

<div id="leaderboard" class="w-full max-w-sm lg:max-w-xs h-full flex flex-col bg-white/50 backdrop-blur-sm p-4 rounded-2xl shadow-lg">
<h2 class="text-2xl font-extrabold text-blue-600 mb-4 text-center border-b-2 border-blue-400/50 pb-2">ğŸ† ì‹¤ì‹œê°„ ë­í‚¹ ğŸ†</h2>
<div id="leaderboard-list" class="flex-grow overflow-y-auto pr-2">
<p class="text-gray-600">ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
</div>
</div>
</div>
<div id="nicknameModal" class="hidden absolute inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50">
<div class="bg-white p-6 rounded-2xl shadow-lg text-center w-80 transform transition-all scale-95 opacity-0">
<h3 class="text-xl font-bold mb-4">ë‹‰ë„¤ì„ ë³€ê²½</h3>
<input type="text" id="nicknameInput" class="w-full p-2 border rounded-lg mb-4 text-center" placeholder="ìƒˆ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš” (10ì ì´ë‚´)" maxlength="10">
<div class="flex gap-2">
<button id="saveNicknameBtn" class="w-full bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-600 transition">ì €ì¥</button>
<button id="cancelNicknameBtn" class="w-full bg-gray-300 py-2 rounded-lg hover:bg-gray-400 transition">ì·¨ì†Œ</button>
</div>
</div>
</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, doc, setDoc, query, orderBy, limit, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

// --- Firebase & Nickname Setup ---
let db, auth;
let userId = null;
let userNickname = null;

const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-code-stacker';
const firebaseConfig = {
    apiKey: "AIzaSyCA88k77fUZoDodoswX30cChwMtVtE1k1A",
    authDomain: "ssafy-stacker.firebaseapp.com",
    projectId: "ssafy-stacker",
    storageBucket: "ssafy-stacker.firebasestorage.app",
    messagingSenderId: "786452432268",
    appId: "1:786452432268:web:46df073c69ecf3cab382a9",
    measurementId: "G-EM6VY17XXH"
  };
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
const userNicknameDisplay = document.getElementById('userNicknameDisplay');
const nicknameModal = document.getElementById('nicknameModal');
const nicknameModalContent = nicknameModal.querySelector('div');
const editNicknameBtn = document.getElementById('editNicknameBtn');
const saveNicknameBtn = document.getElementById('saveNicknameBtn');
const cancelNicknameBtn = document.getElementById('cancelNicknameBtn');
const nicknameInput = document.getElementById('nicknameInput');
// Game Over Nickname Prompt elements
const gameOverNicknamePrompt = document.getElementById('gameOverNicknamePrompt');
const nicknameInputGameOver = document.getElementById('nicknameInputGameOver');
const saveNicknameBtnGameOver = document.getElementById('saveNicknameBtnGameOver');

function updateNicknameDisplay() {
userNicknameDisplay.textContent = userNickname || 'ê²ŒìŠ¤íŠ¸';
}

function openNicknameModal() {
nicknameInput.value = userNickname || '';
nicknameModal.classList.remove('hidden');
nicknameModal.classList.add('flex');
setTimeout(() => nicknameModalContent.classList.remove('scale-95', 'opacity-0'), 10);
}

function closeNicknameModal() {
nicknameModalContent.classList.add('scale-95', 'opacity-0');
setTimeout(() => nicknameModal.classList.add('hidden'), 200);
}

function handleNicknameSave(newNickname) {
if (newNickname && newNickname.length > 0) {
userNickname = newNickname;
localStorage.setItem(`stackerNickname_${userId}`, userNickname);
updateNicknameDisplay();
updateNicknameInFirestore();
return true;
}
return false;
}

editNicknameBtn.addEventListener('click', openNicknameModal);
cancelNicknameBtn.addEventListener('click', closeNicknameModal);
saveNicknameBtn.addEventListener('click', () => {
const newNickname = nicknameInput.value.trim();
if (handleNicknameSave(newNickname)) {
closeNicknameModal();
} else {
alert('ë‹‰ë„¤ì„ì€ ë¹„ì›Œë‘˜ ìˆ˜ ì—†ì–´ìš”!');
}
});

saveNicknameBtnGameOver.addEventListener('click', (e) => {
e.stopPropagation();
const newNickname = nicknameInputGameOver.value.trim();
if (handleNicknameSave(newNickname)) {
gameOverNicknamePrompt.classList.add('hidden');
} else {
nicknameInputGameOver.value = '';
nicknameInputGameOver.placeholder = "ë‹¤ì‹œ ì…ë ¥!";
nicknameInputGameOver.classList.add('border-red-600');
}
});
nicknameInputGameOver.addEventListener('click', e => e.stopPropagation());
nicknameInputGameOver.addEventListener('keydown', e => e.stopPropagation());

if (firebaseConfig) {
try {
const app = initializeApp(firebaseConfig);
db = getFirestore(app);
auth = getAuth(app);
onAuthStateChanged(auth, (user) => {
if (user) {
userId = user.uid;
userNickname = localStorage.getItem(`stackerNickname_${userId}`) || `ê²Œì´ë¨¸${userId.substring(0, 4)}`;
updateNicknameDisplay();
listenToLeaderboard();
}
});

if (initialAuthToken) {
signInWithCustomToken(auth, initialAuthToken);
} else {
signInAnonymously(auth);
}
} catch (e) {
console.error("Firebase initialization failed:", e);
userNicknameDisplay.textContent = "ì—°ê²° ì‹¤íŒ¨";
}
} else {
userId = localStorage.getItem('stackerUserId');
if (!userId) {
userId = 'local-' + Math.random().toString(36).substr(2, 9);
localStorage.setItem('stackerUserId', userId);
}
userNickname = localStorage.getItem(`stackerNickname_${userId}`) || 'ë¡œì»¬ ìœ ì €';
updateNicknameDisplay();
// document.getElementById('leaderboard').style.display = 'none';
    document.getElementById('leaderboard-list').innerHTML = '<p class="text-sm text-gray-600 p-2">ì„œë²„ ì—°ê²° ëŒ€ê¸° ì¤‘...<br>(ë¡œì»¬ ëª¨ë“œ)</p>';
}

async function updateNicknameInFirestore() {
if (!db || !userId) return;
try {
const userDocRef = doc(db, `artifacts/${appId}/public/data/stacker_leaderboard`, userId);
await setDoc(userDocRef, { nickname: userNickname }, { merge: true });
} catch (error) {
console.error("Error updating nickname:", error);
}
}

async function saveScore(newScore) {
if (!db || !userId) return;
try {
const userDocRef = doc(db, `artifacts/${appId}/public/data/stacker_leaderboard`, userId);
const userDoc = await getDoc(userDocRef);
const currentData = userDoc.exists() ? userDoc.data() : { score: 0 };

if (newScore > currentData.score) {
await setDoc(userDocRef, {
userId: userId,
nickname: userNickname,
score: newScore,
timestamp: new Date()
}, { merge: true });
} else if (!currentData.nickname || currentData.nickname !== userNickname) {
await setDoc(userDocRef, { nickname: userNickname }, { merge: true });
}
} catch (error) {
console.error("Error saving score: ", error);
}
}

function listenToLeaderboard() {
if (!db) return;
const leaderboardRef = collection(db, `artifacts/${appId}/public/data/stacker_leaderboard`);
const q = query(leaderboardRef, orderBy("score", "desc"), limit(50));
onSnapshot(q, (snapshot) => {
const leaderboardList = document.getElementById('leaderboard-list');
leaderboardList.innerHTML = '';

if (snapshot.empty) {
leaderboardList.innerHTML = '<p class="text-gray-600">ì•„ì§ ë­í‚¹ì´ ì—†ì–´ìš”! 1ë“±ì— ë„ì „í•˜ì„¸ìš”!</p>';
return;
}
snapshot.docs.forEach((doc, index) => {
const data = doc.data();
const rank = index + 1;
const isCurrentUser = data.userId === userId;
const displayName = data.nickname || `ê²Œì´ë¨¸${data.userId.substring(0,4)}`;

const entry = document.createElement('div');
entry.className = `flex items-center justify-between p-2 my-1 rounded-lg transition-all ${isCurrentUser ? 'bg-blue-400 text-white scale-105 shadow-md' : 'bg-white/70'}`;
let rankDisplay;
if (rank === 1) rankDisplay = 'ğŸ¥‡';
else if (rank === 2) rankDisplay = 'ğŸ¥ˆ';
else if (rank === 3) rankDisplay = 'ğŸ¥‰';
else rankDisplay = `#${rank}`;

entry.innerHTML = `
<div class="flex items-center gap-3">
<span class="font-bold w-8 text-center text-lg">${rankDisplay}</span>
<span class="truncate font-bold text-sm" title="${displayName}">${displayName}</span>
</div>
<span class="font-bold text-gray-700">${data.score} ì¸µ</span>
`;
leaderboardList.appendChild(entry);
});
}, (error) => {
console.error("Error listening to leaderboard: ", error);
document.getElementById('leaderboard-list').innerHTML = '<p class="text-red-600">ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆì–´ìš”.</p>';
});
}

// --- Game Logic ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreElement = document.getElementById('score');
const comboDisplay = document.getElementById('combo-display');
const gameOverScreen = document.getElementById('gameOverScreen');
const finalScore = document.getElementById('finalScore');
const popupContainer = document.getElementById('popup-container');

function createPopup(text, color) {
const popup = document.createElement('div');
popup.textContent = text;
popup.className = 'perfect-popup text-4xl font-extrabold';
popup.style.color = color;
popup.style.textShadow = '2px 2px 4px rgba(0,0,0,0.2)';
popupContainer.appendChild(popup);
setTimeout(() => {
if (popup.parentNode) {
popup.parentNode.removeChild(popup);
}
}, 600);
}

const BLOCK_HEIGHT = 120;
const PERFECT_TOLERANCE = 15;

// --- [ë³€ê²½] ë¬´ì§€ê°œ ìƒ‰ìƒ ë°°ì—´ ---
const rainbowColors = [
    '#ffadad', // Red
    '#ffd6a5', // Orange
    '#fdffb6', // Yellow
    '#caffbf', // Green
    '#9bf6ff', // Cyan/Blue
    '#a0c4ff', // Indigo
    '#bdb2ff'  // Violet
];

// --- [ë³€ê²½] ì´ ìºë¦­í„° ìˆ˜ ì„¤ì • ---
const TOTAL_CHARACTERS = 56; // char1.png ~ char57.png

let blocks, currentBlock, gameState, score, combo, blockSpeed, fallSpeed;

function resizeCanvas() {
const container = canvas.parentElement;
canvas.width = container.clientWidth;
canvas.height = container.clientHeight;
}

function drawBlock(block) {
    // 1. ë°°ê²½ ë¸”ë¡ ê·¸ë¦¬ê¸°
    ctx.fillStyle = block.color;
    ctx.strokeStyle = 'rgba(0,0,0,0.2)';
    ctx.lineWidth = 2;
    const radius = 5;
    const { x, y, width, height } = block;

    ctx.beginPath();
    ctx.moveTo(x + radius, y);
    ctx.lineTo(x + width - radius, y);
    ctx.arcTo(x + width, y, x + width, y + radius, radius);
    ctx.lineTo(x + width, y + height - radius);
    ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius);
    ctx.lineTo(x + radius, y + height);
    ctx.arcTo(x, y + height, x, y + height - radius, radius);
    ctx.lineTo(x, y + radius);
    ctx.arcTo(x, y, x + radius, y, radius);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    // 2. ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
 if (block.image && block.image.complete && block.image.naturalWidth > 0) {
        const padding = 2; // ì—¬ë°±ì„ ì¡°ê¸ˆ ë” ì¤Œ
        
        // ë¸”ë¡ ì˜ì—­ ì•ˆì—ì„œ ì´ë¯¸ì§€ê°€ ë¹„ìœ¨ì„ ìœ ì§€í•˜ë„ë¡ ê³„ì‚° (fit)
        // ë¸”ë¡ì˜ ê°€ë¡œ/ì„¸ë¡œ ì¤‘ ë” ì‘ì€ ìª½ì„ ê¸°ì¤€ìœ¼ë¡œ í¬ê¸° ë§ì¶¤
        const size = Math.min(block.width, block.height) - (padding * 2);
        
        if (size > 0) {
            // ì´ë¯¸ì§€ë¥¼ í•­ìƒ ë¸”ë¡ ì¤‘ì•™ì— ê·¸ë¦¼
            const imgX = block.x + (block.width - size) / 2;
            const imgY = block.y + (block.height - size) / 2;

            ctx.drawImage(block.image, imgX, imgY, size, size);
        }
    }
}


function init() {
    gameState = 'waiting';
    score = 0;
    combo = 0;
    blockSpeed = 1;
    fallSpeed = 15; 
    scoreElement.textContent = score;
    comboDisplay.textContent = '';
    gameOverScreen.classList.add('hidden');
    gameOverScreen.classList.remove('flex');
    gameOverNicknamePrompt.classList.add('hidden');

    blocks = [];
    const baseBlockWidth = BLOCK_HEIGHT*1.6
    
    // ì²« ë¸”ë¡ (ë¹¨ê°„ìƒ‰, 1ë²ˆ ìºë¦­í„°)
    const baseImg = new Image();
    baseImg.src = './assets/char18.png';
    
    const baseBlock = {
        x: (canvas.width - baseBlockWidth) / 2,
        y: canvas.height - BLOCK_HEIGHT,
        width: baseBlockWidth,
        height: BLOCK_HEIGHT,
        color: rainbowColors[6], // ë¹¨ê°„ìƒ‰ ì‹œì‘
        image: baseImg
    };
    blocks.push(baseBlock);
    spawnNewBlock();
}

// --- [ë³€ê²½] ë¬´ì§€ê°œ ìƒ‰ìƒ + ëœë¤ ìºë¦­í„° ìŠ¤í° í•¨ìˆ˜ ---
function spawnNewBlock() {
    const lastBlock = blocks[blocks.length - 1];

    // 1. ìƒ‰ìƒ ê²°ì • (ë¬´ì§€ê°œ ìˆœì„œ)
    // í˜„ì¬ ì ìˆ˜ì— ë”°ë¼ ìƒ‰ìƒ ì¸ë±ìŠ¤ ê²°ì • (scoreê°€ 1, 2, 3... ì˜¬ë¼ê°ˆ ë•Œë§ˆë‹¤ ìƒ‰ë„ ë³€í•¨)
    const colorIndex = score % rainbowColors.length;
    const nextColor = rainbowColors[colorIndex];

    // 2. ìºë¦­í„° ê²°ì • (ì™„ì „ ëœë¤)
    // 1 ~ 57 ì‚¬ì´ì˜ ëœë¤ ì •ìˆ˜ ìƒì„±
    const randomCharNum = Math.floor(Math.random() * TOTAL_CHARACTERS) + 1;
    const nextImage = new Image();
    nextImage.src = `./assets/char${randomCharNum}.png`;

    currentBlock = {
        x: 0,
        y: 40,
        width: lastBlock.width,
        height: BLOCK_HEIGHT,
        speed: blockSpeed,
        direction: 1,
        isFalling: false,
        color: nextColor,    // ìˆœì„œëŒ€ë¡œ
        image: nextImage     // ëœë¤í•˜ê²Œ
    };
}

function handleInput() {
    if (gameState === 'waiting') {
        gameState = 'playing';
    } else if (gameState === 'playing') {
        gameState = 'dropping';
        currentBlock.isFalling = true;
    } else if (gameState === 'gameOver') {
        init();
    }
}

function update() {
    if (gameState !== 'playing' && gameState !== 'dropping') return;

    if (currentBlock.isFalling) {
        const lastBlock = blocks[blocks.length - 1];
        currentBlock.y += fallSpeed;
        if (currentBlock.y + currentBlock.height >= lastBlock.y) {
            currentBlock.y = lastBlock.y - currentBlock.height;
            const overlap = Math.max(0, Math.min(currentBlock.x + currentBlock.width, lastBlock.x + lastBlock.width) - Math.max(currentBlock.x, lastBlock.x));
            if (overlap <= 0) {
                gameState = 'gameOver';
                finalScore.textContent = score;
                saveScore(score); 
                gameOverScreen.classList.remove('hidden');
                gameOverScreen.classList.add('flex');
                if (userNickname && userNickname.startsWith('ê²Œì´ë¨¸')) {
                    gameOverNicknamePrompt.classList.remove('hidden');
                    nicknameInputGameOver.value = '';
                    nicknameInputGameOver.classList.remove('border-red-500');
                    nicknameInputGameOver.placeholder = "ë‹‰ë„¤ì„ (10ì ì´ë‚´)";
                } else {
                    gameOverNicknamePrompt.classList.add('hidden');
                }
                return;
            }

            const isPerfect = Math.abs(currentBlock.x - lastBlock.x) <= PERFECT_TOLERANCE;
            let newBlock;

            if (isPerfect) {
                combo++;
                newBlock = { 
                    ...lastBlock, 
                    y: currentBlock.y, 
                    color: currentBlock.color, 
                    image: currentBlock.image 
                };
                comboDisplay.textContent = `PERFECT x${combo}!`;
                createPopup('PERFECT!', '#5244ef');
            } else {
                combo = 0;
                comboDisplay.textContent = '';
                const newX = Math.max(currentBlock.x, lastBlock.x);
                newBlock = {
                    x: newX,
                    y: currentBlock.y,
                    width: overlap,
                    height: currentBlock.height,
                    color: currentBlock.color, // ìƒ‰ìƒ ìœ ì§€
                    image: currentBlock.image  // ì´ë¯¸ì§€ ìœ ì§€
                };
            }
            blocks.push(newBlock);
            score++;
            scoreElement.textContent = score;
            blockSpeed += 0.08;
            if (newBlock.y < canvas.height * 0.6) {
                blocks.forEach(b => b.y += BLOCK_HEIGHT);
            }
            spawnNewBlock();
            gameState = 'playing';
        }

    } else {
        currentBlock.x += currentBlock.speed * currentBlock.direction;
        if (currentBlock.x + currentBlock.width >= canvas.width || currentBlock.x <= 0) {
            currentBlock.direction *= -1;
            currentBlock.x = Math.max(0, Math.min(currentBlock.x, canvas.width - currentBlock.width));
        }
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const visibleBlocks = blocks.filter(b => b.y < canvas.height && b.y + b.height > 0);
    visibleBlocks.forEach(block => {
        drawBlock(block);
    });
    if (gameState === 'playing' || gameState === 'dropping') {
        drawBlock(currentBlock);
    }
}
function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}
window.addEventListener('resize', resizeCanvas);
document.body.addEventListener('keydown', (e) => {
    if (e.code === 'Space') {
        e.preventDefault();
        handleInput();
    }
});
document.body.addEventListener('mousedown', (e) => {
    if (nicknameModal.classList.contains('hidden')) {
        handleInput();
    }
});
document.body.addEventListener('touchstart', (e) => {
    if (nicknameModal.classList.contains('hidden')) {
        e.preventDefault();
        handleInput();
    }
}, { passive: false });

resizeCanvas();
init();
gameLoop();
</script>
</body>
</html>